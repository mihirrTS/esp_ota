{% extends "base.html" %}

{% block title %}Default Content{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>
                        <i class="fas fa-edit me-2"></i>
                        Default Content Management
                    </h4>
                    <a href="{{ url_for('content_sources') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Sources
                    </a>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        This is the preset content that will be used when API sources are disabled or unavailable.
                        You can add multiple items for each category.
                    </div>
                    
                    <ul class="nav nav-tabs" id="contentTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="jokes-tab" data-bs-toggle="tab" 
                                    data-bs-target="#jokes" type="button" role="tab">
                                ðŸ˜„ Jokes
                                <span class="badge bg-primary ms-2">{{ jokes|length }}</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="riddles-tab" data-bs-toggle="tab" 
                                    data-bs-target="#riddles" type="button" role="tab">
                                ðŸ§© Riddles
                                <span class="badge bg-primary ms-2">{{ riddles|length }}</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="news-tab" data-bs-toggle="tab" 
                                    data-bs-target="#news" type="button" role="tab">
                                ðŸ“° News
                                <span class="badge bg-primary ms-2">{{ news|length }}</span>
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3" id="contentTabsContent">
                        <!-- Jokes Tab -->
                        <div class="tab-pane fade show active" id="jokes" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-plus me-2"></i>Add New Joke</h5>
                                </div>
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('edit_default_content', category='jokes') }}">
                                        <div class="mb-3">
                                            <label for="jokes_subcategory" class="form-label">Subcategory</label>
                                            <input type="text" class="form-control" name="subcategory" 
                                                   placeholder="e.g., dad_jokes, programming" value="default">
                                        </div>
                                        <div class="mb-3">
                                            <label for="jokes_content" class="form-label">Joke Content</label>
                                            <textarea class="form-control" name="content" rows="3" 
                                                      placeholder="Enter your joke here..." required></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-plus me-2"></i>Add Joke
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                {% for joke in jokes %}
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <small class="text-muted">{{ joke.subcategory.replace('_', ' ').title() }}</small>
                                                <p class="mb-1">{{ joke.content }}</p>
                                            </div>
                                            <form method="POST" action="{{ url_for('edit_default_content', category='jokes', item_id=joke.id, action='delete') }}" 
                                                  onsubmit="return confirm('Delete this joke?')" class="ms-2">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if not jokes %}
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-laugh fa-3x mb-3"></i>
                                    <p>No jokes added yet. Add some humor above!</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Riddles Tab -->
                        <div class="tab-pane fade" id="riddles" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-plus me-2"></i>Add New Riddle</h5>
                                </div>
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('edit_default_content', category='riddles') }}">
                                        <div class="mb-3">
                                            <label for="riddles_subcategory" class="form-label">Subcategory</label>
                                            <input type="text" class="form-control" name="subcategory" 
                                                   placeholder="e.g., math, word_play" value="default">
                                        </div>
                                        <div class="mb-3">
                                            <label for="riddles_question" class="form-label">Riddle Question</label>
                                            <textarea class="form-control" name="question" rows="2" 
                                                      placeholder="Enter the riddle question..." required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="riddles_answer" class="form-label">Answer</label>
                                            <textarea class="form-control" name="answer" rows="2" 
                                                      placeholder="Enter the answer..." required></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-plus me-2"></i>Add Riddle
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                {% for riddle in riddles %}
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <small class="text-muted">{{ riddle.subcategory.replace('_', ' ').title() }}</small>
                                                <p class="mb-1"><strong>Q:</strong> {{ riddle.question }}</p>
                                                <p class="mb-1 text-success"><strong>A:</strong> {{ riddle.answer }}</p>
                                            </div>
                                            <form method="POST" action="{{ url_for('edit_default_content', category='riddles', item_id=riddle.id, action='delete') }}" 
                                                  onsubmit="return confirm('Delete this riddle?')" class="ms-2">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if not riddles %}
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-puzzle-piece fa-3x mb-3"></i>
                                    <p>No riddles added yet. Challenge minds above!</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- News Tab -->
                        <div class="tab-pane fade" id="news" role="tabpanel">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-plus me-2"></i>Add News Article</h5>
                                </div>
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('edit_default_content', category='news') }}">
                                        <div class="mb-3">
                                            <label for="news_subcategory" class="form-label">Subcategory</label>
                                            <input type="text" class="form-control" name="subcategory" 
                                                   placeholder="e.g., tech, world, sports" value="general">
                                        </div>
                                        <div class="mb-3">
                                            <label for="news_title" class="form-label">News Title</label>
                                            <input type="text" class="form-control" name="title" 
                                                   placeholder="Enter news headline..." required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="news_content" class="form-label">News Content</label>
                                            <textarea class="form-control" name="content" rows="4" 
                                                      placeholder="Enter news article content..." required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="news_url" class="form-label">Source URL (Optional)</label>
                                            <input type="url" class="form-control" name="url" 
                                                   placeholder="https://source.example.com/article">
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-plus me-2"></i>Add News
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                {% for article in news %}
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <div class="d-flex justify-content-between align-items-center mb-1">
                                                    <small class="text-muted">{{ article.subcategory.replace('_', ' ').title() }}</small>
                                                    <small class="text-muted">{{ article.created_at.strftime('%m/%d/%Y') if article.created_at else '' }}</small>
                                                </div>
                                                <h6 class="mb-2">{{ article.title }}</h6>
                                                <p class="mb-1">{{ article.content[:200] }}{% if article.content|length > 200 %}...{% endif %}</p>
                                                {% if article.url %}
                                                <a href="{{ article.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-external-link-alt me-1"></i>Source
                                                </a>
                                                {% endif %}
                                            </div>
                                            <form method="POST" action="{{ url_for('edit_default_content', category='news', item_id=article.id, action='delete') }}" 
                                                  onsubmit="return confirm('Delete this article?')" class="ms-2">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                
                                {% if not news %}
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-newspaper fa-3x mb-3"></i>
                                    <p>No news articles added yet. Share some news above!</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-save functionality for larger content
document.addEventListener('DOMContentLoaded', function() {
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        let timeout;
        textarea.addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                // Auto-save draft functionality could be added here
                console.log('Content changed in', textarea.name);
            }, 2000);
        });
    });
});
</script>
{% endblock %}